1.exfat 
采用exfat-nofuse

参考链接：
http://blog.irsqs.com/archives/12


2.禁止一些无用的开机服务
apt-get install rcconf

列出当前开机启动的服务
rcconf --list
root@tegra-ubuntu:/lib/systemd/system# rcconf --list
nfs-kernel-server on
saned on
cryptdisks on
lvm2-lvmetad on
speech-dispatcher on
anacron on
whoopsie on
brltty on
apparmor on
rsync on
lvm2-lvmpolld on
rpcbind on
hostapd on
lightdm on
bluetooth on
cups-browsed on
gpsd on
kmod on
avahi-daemon on
procps on
console-setup on
plymouth on
ssh on
kerneloops on
plymouth-log on
alsa-utils on
apport on
checkroot-bootclean.sh on
x11-common on
dnsmasq on
dbus on
udev on
cups on
lvm2 on
cron on
pppd-dns on
nmbd on
smbd on
rsyslog on
samba-ad-dc on
samba off

禁止无用的服务：
root@tegra-ubuntu:/lib/systemd/system# rcconf --off bluetooth
root@tegra-ubuntu:/lib/systemd/system# rcconf --off dnsmasq
root@tegra-ubuntu:/lib/systemd/system# rcconf --off pppd-dns
root@tegra-ubuntu:/lib/systemd/system# rcconf --off avahi-daemon
root@tegra-ubuntu:/lib/systemd/system# rcconf --off gpsd
root@tegra-ubuntu:/lib/systemd/system# rcconf --off hostapd



安装最新的exfat工具
github: https://github.com/relan/exfat




UD REPO操作：
克隆远程仓库：
repo init -u ssh://git.uditech.org/Robot/ZWJ/ubuntu/insta360/tx2_28.2.1/manifest.git -b master -m default.xml --repo-url ssh://git.uditech.org/git-repo.git

同步：
repo sync -j8
repo start master --all



编译cboot

Use these procedures to build the T186 CBoot binary using the standalone
source contained in the cboot_src.tbz2 archive.

==============================================================================
Requirements for Compiling on the Host
==============================================================================
Before you can compile on the host, the following requirements must be met:

- A recent 64-bit ARM toolchain is required. It must be in your PATH, unless
  you explicitly set it in your CROSS_COMPILE environment variable, as follows.

- The CBoot makefile uses the toolchain set in the CROSS_COMPILE environment
  variable. The variable must be set to point to the ARM 64-bit toolchain
  used by L4T, and must be in your path.

  For example:

  export CROSS_COMPILE=aarch64-unknown-linux-gnu-

  Consult the Linux for Tegra Development Guide for detailed toolchain information.

- A GNU Make tool must be available.

- Create a directory for the CBoot source to extract and build the source.
  In subsequent procedures, the source subdirectory is called "cboot".
  The resulting binaries are placed in the 'out' subdirectory, i.e. cboot/out.

=================================================================================
Building the CBoot Binary
=================================================================================
To build the CBoot binary:
1. Extract the CBoot-standalone source with the command:
   md cboot
   tar -xjf cboot_src.tbz2 -C cboot
   cd cboot

2. Export the cross compiler tools with the following enviroment variables:
   export CROSS_COMPILE=<your_64-bit_ARM_toolchain_triple>
   export CROSS_COMPILE=/home/skymixos/work/titan/sdk/prebuilts/gcc/aarch64/install/bin/aarch64-linux-gnu-


   Where: <your_64-bit_ARM_toolchain_triple> can be: 'aarch64-linux-gnu-'

3. Build the T186 CBoot binary, lk.bin, with the command:
   make -C ./bootloader/partner/t18x/cboot PROJECT=t186 TOOLCHAIN_PREFIX="${CROSS_COMPILE}" DEBUG=2 BUILDROOT="${PWD}"/out NV_BUILD_SYSTEM_TYPE=l4t NOECHO=@

   make -C ./bootloader/partner/t18x/cboot PROJECT=t186 TOOLCHAIN_PREFIX="aarch64-linux-gnu-" DEBUG=2 BUILDROOT="${PWD}"/out NV_BUILD_SYSTEM_TYPE=l4t NOECHO=@

   The binary is located at: './out/build-t186/...':

   cboot/out/build-t186/lk.bin

4. Rename the binary lk.bin to cboot.bin to use with the Jetson TX2 (T186)
   Linux for Tegra Board Support Package.

   This CBoot binary replaces the one provided at: Linux_for_Tegra/bootloader/cboot.bin.


编译cboot.bin:
export CROSS_COMPILE=/home/skymixos/work/titan/sdk/prebuilts/gcc/aarch64/install/bin/aarch64-unknown-linux-gnu-
make -C ./bootloader/partner/t18x/cboot PROJECT=t186 TOOLCHAIN_PREFIX="${CROSS_COMPILE}" DEBUG=2 BUILDROOT="${PWD}"/out NV_BUILD_SYSTEM_TYPE=l4t NOECHO=@
cp ./out/build-t186/lk.bin  /home/skymixos/work/titan/sdk/64_TX2/Linux_for_Tegra/bootloader/cboot.bin


烧写cboot.bin
sudo ./flash.sh -k cpu-bootloader jetson-tx2 mmcblk0p1

HDMI:
tegra186-cvb-prod-p2597-b00-p3310-1000-a00-00.dtsi


修改扩展p10-p15修改的文件：bootloader/partner/common/drivers/gpio/tca9539_gpio.c


1.禁止系统自动睡眠
2.安装常用工具
samba

3.移植应用环境
4.禁止U盘功能
/opt/nvidia/l4t-usb-device-mode/nv-l4t-usb-device-mode.sh

5.支持外设



TITAN板子
HDMI在无任何连接的情况下，显示有连接
Screen 0: minimum 8 x 8, current 1280 x 720, maximum 32767 x 32767
HDMI-0 connected primary 1280x720+0+0 (normal left inverted right x axis y axis) 890mm x 500mm
   1280x720      60.00*+  59.94    50.00  
   720x576       50.00  
   720x480       59.94  
   640x480       59.94 




APP遗留问题
1.网络管理器部分
2.查询部分
3.数据库



按键的问题：
问题描述：设置键按下时只报按下事件，过了一会会上报一堆的事件
原因：设置脚对应的GPIO，内部没有上拉，修改tegra186-mb1-bct-pinmux-quil-p3310-1000-c03.cfg
Linux_for_Tegra/bootloader/t186ref/tegra186-mb1-bct-pinmux-quil-p3310-1000-c03.cfg
PBB0需要内部上拉

音频问题：
音频模块的上电问题


网络问题：
udhcpc获取IP的时间是否比dhclient的时间更短？



添加用户按键的gpio使用情况:
# cat /sys/kernel/debug/gpio

GPIOs 232-239, platform/max77620-gpio, max77620-gpio, can sleep:
 gpio-232 (                    |external-connection:) in  hi    
 gpio-237 (                    |spmic_gpio_input_5  ) in  lo    
 gpio-238 (                    |spmic_gpio_input_6  ) in  hi    

GPIOs 240-255, i2c/0-0077, tca9539, can sleep:
 gpio-240 (                    |sysfs               ) out lo    
 gpio-241 (                    |sysfs               ) out lo    
 gpio-242 (                    |sysfs               ) out lo    
 gpio-243 (                    |sysfs               ) out lo    
 gpio-244 (                    |sysfs               ) out lo    
 gpio-245 (                    |sysfs               ) out lo    
 gpio-246 (                    |sysfs               ) out lo    
 gpio-247 (                    |sysfs               ) out lo    
 gpio-248 (                    |front_red           ) out hi    
 gpio-249 (                    |front_green         ) out hi    
 gpio-250 (                    |front_blue          ) out hi    
 gpio-251 (                    |back_red            ) out lo    
 gpio-252 (                    |back_green          ) out lo    
 gpio-253 (                    |back_blue           ) out lo    
 gpio-254 (                    |vdd-hdmi            ) out hi    
 gpio-255 (                    |tegra_fan           ) out hi    

GPIOs 256-319, platform/c2f0000.gpio, tegra-gpio-aon:
 gpio-259 (                    |sysfs               ) out hi    
 gpio-272 (                    |temp_alert          ) in  hi    
 gpio-298 (                    |sysfs               ) out lo    
 gpio-303 (                    |sysfs               ) out lo    
 gpio-312 (                    |Power               ) in  hi    
 gpio-313 (                    |Up                  ) in  hi    
 gpio-314 (                    |Down                ) in  hi    
 gpio-315 (                    |user-key1           ) in  hi    
 gpio-316 (                    |bt_host_wake        ) in  hi    

GPIOs 320-511, platform/2200000.gpio, tegra-gpio:
 gpio-381 (                    |reset_gpio          ) out lo    
 gpio-390 (                    |sysfs               ) out lo    
 gpio-397 (                    |sysfs               ) out hi    
 gpio-412 (                    |vdd-usb0-5v         ) out lo    
 gpio-413 (                    |vdd-usb1-5v         ) out lo    
 gpio-420 (                    |eqos_phy_reset      ) out hi    
 gpio-421 (                    |eqos_phy_intr       ) in  hi    
 gpio-426 (                    |cam1-pwdn           ) out lo    
 gpio-441 (                    |hdmi2.0_hpd         ) in  hi    
 gpio-445 (                    |sdmmc-wake-input    ) in  hi    
 gpio-446 (                    |en-vdd-sd           ) out hi    
 gpio-456 (                    |cam0-pwdn           ) out lo    
 gpio-457 (                    |cam1-rst            ) out lo    
 gpio-461 (                    |sysfs               ) out lo    
 gpio-479 (                    |external-connection:) in  lo    
 gpio-481 (                    |Back                ) in  hi    
 gpio-484 (                    |bt_ext_wake         ) out hi    
 gpio-488 (                    |Setting             ) in  hi    
 gpio-489 (                    |wifi-ap6356s-enable ) out hi


初始GPIO配置：
root@tegra-ubuntu:/home/nvidia# cat /sys/kernel/debug/gpio 
GPIOs 232-239, platform/max77620-gpio, max77620-gpio, can sleep:
 gpio-232 (                    |external-connection:) in  hi    
 gpio-237 (                    |spmic_gpio_input_5  ) in  lo    
 gpio-238 (                    |spmic_gpio_input_6  ) in  hi    

GPIOs 240-255, i2c/0-0077, tca9539, can sleep:
 gpio-240 (                    |sysfs               ) out lo    
 gpio-241 (                    |sysfs               ) out lo    
 gpio-242 (                    |sysfs               ) out lo    
 gpio-243 (                    |sysfs               ) out lo    
 gpio-244 (                    |sysfs               ) out lo    
 gpio-245 (                    |sysfs               ) out lo    
 gpio-246 (                    |sysfs               ) out lo    
 gpio-247 (                    |sysfs               ) out lo    
 gpio-248 (                    |front_red           ) out hi    
 gpio-249 (                    |front_green         ) out hi    
 gpio-250 (                    |front_blue          ) out hi    
 gpio-251 (                    |back_red            ) out lo    
 gpio-252 (                    |back_green          ) out lo    
 gpio-253 (                    |back_blue           ) out lo    
 gpio-254 (                    |vdd-hdmi            ) out hi    
 gpio-255 (                    |tegra_fan           ) out hi    

GPIOs 256-319, platform/c2f0000.gpio, tegra-gpio-aon:
 gpio-259 (                    |sysfs               ) out hi    
 gpio-272 (                    |temp_alert          ) in  hi    
 gpio-298 (                    |sysfs               ) out lo    
 gpio-303 (                    |sysfs               ) out lo    
 gpio-312 (                    |Power               ) in  hi    
 gpio-313 (                    |Up                  ) in  hi    
 gpio-314 (                    |Down                ) in  hi    
 gpio-315 (                    |wifi-wake-ap        ) in  hi    
 gpio-316 (                    |bt_host_wake        ) in  hi    

GPIOs 320-511, platform/2200000.gpio, tegra-gpio:
 gpio-381 (                    |reset_gpio          ) out lo    
 gpio-390 (                    |sysfs               ) out lo    
 gpio-397 (                    |sysfs               ) out hi    
 gpio-412 (                    |vdd-usb0-5v         ) out lo    
 gpio-413 (                    |vdd-usb1-5v         ) out lo    
 gpio-420 (                    |eqos_phy_reset      ) out hi    
 gpio-421 (                    |eqos_phy_intr       ) in  hi    
 gpio-426 (                    |cam1-pwdn           ) out lo    
 gpio-441 (                    |hdmi2.0_hpd         ) in  hi    
 gpio-445 (                    |sdmmc-wake-input    ) in  hi    
 gpio-446 (                    |en-vdd-sd           ) out hi    
 gpio-456 (                    |cam0-pwdn           ) out lo    
 gpio-457 (                    |cam1-rst            ) out lo    
 gpio-461 (                    |sysfs               ) out lo    
 gpio-479 (                    |external-connection:) in  lo    
 gpio-481 (                    |Back                ) in  hi    
 gpio-484 (                    |bt_ext_wake         ) out hi    
 gpio-488 (                    |Setting             ) in  hi    
 gpio-489 (                    |wifi-ap6356s-enable ) out hi    
root@tegra-ubuntu:/home/nvidia# 



USB3.0(SS0) OTG调试：
条件                                         现象                              结论
开机插上USB3.0 TYPE-C线             RNDIS识别成3.0设备，U盘识别成2.0设备            正确
开机插上USB2.0 TYPE-C线             


开机不插Type-C线                    U盘被识别成2.0设备                            错误，正常应该显示为USB3.0设备
手动操作可校正:（可通过检测 gpio-479的输入状态来检测是否有Type-C的插入）
echo 0x2 > /sys/class/extcon/extcon0/state 
echo 1 > /sys/class/gpio/gpio390/value
echo 0 > /sys/class/gpio/gpio390/value




电池调试：
SMBus兼容I2C，但是其支持的最大的时钟频率为100KHz，而I2C adapter的dtb中配置的总线时钟为400KHz，所以使用
i2cdect工具探测不到电池设备：
修改dts源文件：nvidia/soc/t18x/kernel-dts/tegra186-soc/tegra186-soc-i2c.dtsi
将总线的时钟修改为100KHz，再使用i2cdect工具探测设备：

不插电池：
root@tegra-ubuntu:/home/nvidia# i2cdetect  -r -y 2
     0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f
00:          -- -- -- -- -- -- -- -- -- -- -- -- -- 
10: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
20: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
30: -- -- -- -- -- -- -- -- -- -- -- -- 3c -- -- -- 
40: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
50: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
60: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
70: -- -- -- -- -- -- -- --

插上电池：
root@tegra-ubuntu:/home/nvidia# i2cdetect  -r -y 2
     0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f
00:          -- -- -- -- -- -- -- -- 0b -- -- -- -- 
10: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
20: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
30: -- -- -- -- -- -- -- -- -- -- -- -- 3c -- -- -- 
40: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
50: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
60: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 

电池的设备地址为0x0B,不是供应商所谓的0x1B






RIFF块
4952 4646: RIFF
56fc 0000: +8等于文件长度

文件格式类型：WAVE
4157 4556：WAVE

fmt块
6d66 2074：fmt（4字节）
0010 0000: 格式块的长度16字节（4字节）
0001：编码格式（PCM数据，2字节）
0002：采用声道（双声道，2字节）
bb80 0000：采样频率（4字节）
ee00 0002：数据传输速率（4字节）声道数×采样频率×每样本的数据位数/8
0004：采样帧大小（2字节）。该数值为:声道数×位数/8。播放软件需要一次处理多个该值大小的字节数据,用该数值调整缓冲区
0010：（2字节）存储每个采样值所用的二进制数位数。常见的位数有 4、8、12、16、24、32

0000000 4952 4646 56fc 0000 4157 4556 6d66 2074
0000010 0010 0000 0001 0002 bb80 0000 ee00 0002
0000020 0004 0010 6164 6174 56d8 0000 de56 dca3
0000030 db3f d954 d8ad d691 d6c2 d480 d585 d325
0000040 d4f1 d27b d520 d29c d5fc d37b d793 d516
0000050 d9db d779 dcc2 da77 e052 de36 e470 e279
0000060 e90e e75c ee33 ecb0 f3a1 f273 f978 f88c
0000070 ff71 fed2 0592 054e 0bb6 0bbf 11be 1222


关于插上外置MIC后，播放音频文件的卡顿问题？
1.初步怀疑是调用aplay导致的？
验证：自己调用alsa-libs API播放wav文件也会出现卡顿问题，并且发现卡顿是周期性出现，怀疑驱动有问题？

2.拔掉外置MIC时，一切又正常，说明是检测是否有外置MIC的程序有问题？


amixer cget -c 1 name="Jack-state" | grep "values=" | grep -v items | cut -d "=" -f 2

t18x/sound/soc/tegra-alt/tegra_t186ref_mobile_rt565x.o
kernel-4.4/sound/soc/codecs/rt5640.c

未插入外置MIC时，检测一次的内核态耗时：
[  544.630303] ----> rt5639_headset_detect jack_inset = 0
[  544.635472] rt5639_headset_detect jack_type = 1

插入外置MIC时，检测一次的内核态耗时：
[  616.660745] ----> rt5639_headset_detect jack_inset = 1
[  617.231282] rt5639_headset_detect jack_type = 4
[  618.253457] ----> rt5639_headset_detect jack_inset = 1
[  618.839888] rt5639_headset_detect jack_type = 4
[  619.861984] ----> rt5639_headset_detect jack_inset = 1
[  620.438363] rt5639_headset_detect jack_type = 4

rt5639_jack_detect

